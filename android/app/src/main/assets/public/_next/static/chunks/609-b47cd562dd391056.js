"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[609],{3998:(e,t,r)=>{r.d(t,{$:()=>u,r:()=>l});var i=r(95155),a=r(12115),o=r(17129),n=r(83101),s=r(64269);let l=(0,n.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),u=a.forwardRef((e,t)=>{let{className:r,variant:a,size:n,asChild:u=!1,...d}=e,c=u?o.DX:"button";return(0,i.jsx)(c,{className:(0,s.cn)(l({variant:a,size:n,className:r})),ref:t,...d})});u.displayName="Button"},9891:(e,t,r)=>{r.d(t,{d:()=>i});let i=new(r(65240)).EventEmitter},11647:(e,t,r)=>{r.d(t,{E:()=>s});var i=r(95155);r(12115);var a=r(83101),o=r(64269);let n=(0,a.F)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function s(e){let{className:t,variant:r,...a}=e;return(0,i.jsx)("div",{className:(0,o.cn)(n({variant:r}),t),...a})}},15894:(e,t,r)=>{r.d(t,{dj:()=>c});var i=r(12115);let a=0,o=new Map,n=e=>{if(o.has(e))return;let t=setTimeout(()=>{o.delete(e),u({type:"REMOVE_TOAST",toastId:e})},1e6);o.set(e,t)},s=[],l={toasts:[]};function u(e){l=((e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===t.toast.id?{...e,...t.toast}:e)};case"DISMISS_TOAST":{let{toastId:r}=t;return r?n(r):e.toasts.forEach(e=>{n(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===r||void 0===r?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===t.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==t.toastId)}}})(l,e),s.forEach(e=>{e(l)})}function d(e){let{...t}=e,r=(a=(a+1)%Number.MAX_SAFE_INTEGER).toString(),i=()=>u({type:"DISMISS_TOAST",toastId:r});return u({type:"ADD_TOAST",toast:{...t,id:r,open:!0,onOpenChange:e=>{e||i()}}}),{id:r,dismiss:i,update:e=>u({type:"UPDATE_TOAST",toast:{...e,id:r}})}}function c(){let[e,t]=i.useState(l);return i.useEffect(()=>(s.push(t),()=>{let e=s.indexOf(t);e>-1&&s.splice(e,1)}),[e]),{...e,toast:d,dismiss:e=>u({type:"DISMISS_TOAST",toastId:e})}}},37370:(e,t,r)=>{r.d(t,{O:()=>m,J:()=>v});var i=r(95155),a=r(12115),o=r(59253),n=r(19708),s=r(67558),l=r(15894),u=r(20063),d=r(68023);r(32587);let c={async signInWithGoogle(){try{var e;let t=await d.uo.signInWithGoogle({scopes:["profile","email"]});if((null==(e=t.credential)?void 0:e.idToken)&&t.user){let e=t.user;return{user:{uid:e.uid,displayName:e.displayName,email:e.email,photoURL:e.photoUrl,idToken:t.credential.idToken},error:null}}return{user:null,error:Error("No credential returned from native sign-in")}}catch(e){return console.error("Native Google Sign-In Error:",e),{user:null,error:e}}},async signOut(){try{return await d.uo.signOut(),{error:null}}catch(e){return console.error("Native Sign-Out Error:",e),{error:e}}},async getCurrentUser(){try{let e=await d.uo.getCurrentUser();if(e.user){let t=e.user;return{user:{uid:t.uid,displayName:t.displayName,email:t.email,photoURL:t.photoUrl,idToken:null},error:null}}return{user:null,error:null}}catch(e){return console.error("Native Get Current User Error:",e),{user:null,error:e}}},async addAuthStateListener(e){let t=await d.uo.addListener("authStateChange",t=>{if(t.user){let r=t.user;e({uid:r.uid,displayName:r.displayName,email:r.email,photoURL:r.photoUrl,idToken:null})}else e(null)});return()=>{t.remove()}}},f=(0,a.createContext)({user:null,loading:!0,loginWithGoogle:async()=>{},loginWithFacebook:async()=>{},loginAnonymously:async()=>{},bypassLogin:()=>{},logout:async()=>{},updateProfile:async()=>{},addXp:async()=>{}});function p(e){var t;return!!e&&"object"==typeof e&&((null==(t=e.constructor)?void 0:t.name)==="FieldValue"||"string"==typeof e._methodName||"string"==typeof e.type&&["increment","arrayUnion","arrayRemove","serverTimestamp","delete"].includes(e.type)||"_type"in e&&"FieldValue"===e._type)}function m(e){let{children:t}=e,{toast:r}=(0,l.dj)(),d=(0,u.useRouter)(),[m,v]=(0,a.useState)(null),[y,g]=(0,a.useState)(!0),h=(0,a.useRef)(null),w=(0,a.useRef)(!1);(0,a.useEffect)(()=>{h.current=m},[m]),(0,a.useEffect)(()=>{s.auth&&(async()=>{try{let e=await (0,o.Q4)(s.auth);e&&console.log("Redirect sign-in successful:",e.user)}catch(e){console.error("Redirect result error:",e)}})()},[s.auth]),(0,a.useEffect)(()=>{let e;if(!s.auth||!s.firestore)return void g(!1);let t=(0,o.hg)(s.auth,t=>{if(e&&e(),t){g(!0);let i=(0,n.H9)(s.firestore,"users",t.uid);e=(0,n.aQ)(i,async e=>{if(e.exists())v({...function(e,t){let r={...e},i=["credits","xp","streakCount","dailyAdCount","dailyQuestionsAnswered","dailyTestsFinished","dailyCreditEarned","referralCount","referralCreditsEarned","mistakesReviewed","dailyAiUsage"],a=["lastAdXpTimestamp","lastQuickFireTimestamp","lastActiveDate","lastTaskReset","lastQualityUpdate","lastExplanationRequest"];for(let e in i.forEach(e=>{if(void 0===r[e]||null===r[e]||p(r[e])){var i;r[e]=null!=(i=null==t?void 0:t[e])?i:0}}),a.forEach(e=>{if(void 0===r[e]||null===r[e]||p(r[e])){var i;r[e]=null!=(i=null==t?void 0:t[e])?i:Date.now()}else r[e]&&"object"==typeof r[e]&&r[e].toMillis&&(r[e]=r[e].toMillis())}),r)if(!i.includes(e)&&!a.includes(e)&&p(r[e])){var o;r[e]=null!=(o=null==t?void 0:t[e])?o:null}return r}(e.data(),h.current),uid:t.uid});else{let e={uid:t.uid,displayName:t.displayName||(t.isAnonymous?"Guest Educator":"Educator"),email:t.email,photoURL:t.photoURL,onboardingComplete:!1,credits:20,xp:0,lastRewardedRank:1,isPro:!1,dailyAdCount:0,dailyAiUsage:0,dailyQuestionsAnswered:0,dailyTestsFinished:0,dailyCreditEarned:0,streakCount:0,lastActiveDate:(0,n.O5)(),lastTaskReset:(0,n.O5)(),referralCode:Math.random().toString(36).substring(2,8).toUpperCase(),taskLoginClaimed:!1,taskQuestionsClaimed:!1,taskMockClaimed:!1,taskMistakesClaimed:!1,mistakesReviewed:0,referralCount:0,referralCreditsEarned:0,referralTier:"Bronze",dailyEventEntries:1,unlockedTracks:[]};try{await (0,n.BN)(i,e)}catch(e){console.error("Error creating user document:",e),r({variant:"destructive",title:"Setup Failed",description:"Could not create your user profile."})}}g(!1)},e=>{console.error("Firestore subscription error:",e),r({variant:"destructive",title:"Sync Error",description:"Failed to sync your profile."}),g(!1)})}else v(null),g(!1)});return()=>{t(),e&&e()}},[r,s.firestore,s.auth]),(0,a.useEffect)(()=>{if(m&&m.uid&&"bypass-user"!==m.uid&&s.firestore&&!w.current){let e=new Date,t=m.lastTaskReset||0;if(0!==t&&new Date(t).toDateString()!==e.toDateString()){w.current=!0;let e=(0,n.H9)(s.firestore,"users",m.uid);(0,n.mZ)(e,{dailyQuestionsAnswered:0,dailyTestsFinished:0,dailyAiUsage:0,dailyCreditEarned:0,dailyAdCount:0,taskLoginClaimed:!1,taskQuestionsClaimed:!1,taskMockClaimed:!1,taskMistakesClaimed:!1,lastTaskReset:(0,n.O5)()}).catch(e=>console.error("Auto Reset Failed:",e)).finally(()=>{w.current=!1})}}},[null==m?void 0:m.uid,null==m?void 0:m.lastTaskReset,s.firestore]);let b=async e=>{if(m&&s.firestore)try{let t=(0,n.H9)(s.firestore,"users",m.uid);await (0,n.mZ)(t,{xp:(0,n.GV)(e)})}catch(e){console.error("XP Error:",e)}},C=()=>{console.log("[Auth] Checking native platform..."),console.log("[Auth] Capacitor:",window.Capacitor);let e=window.Capacitor;if(e){var t;console.log("[Auth] Capacitor detected");let r=e.platform;if(console.log("[Auth] Capacitor platform:",r),"android"===r||"ios"===r)return console.log("[Auth] Running on native mobile (Capacitor)"),!0;if(!0===(null==(t=e.isNativePlatform)?void 0:t.call(e)))return console.log("[Auth] Running on native mobile (isNativePlatform)"),!0}let r=void 0!==window.android,i=void 0!==window.webkit;return(console.log("[Auth] window.android:",r,"window.webkit:",i),r||i)?(console.log("[Auth] Running on native mobile (window fallback)"),!0):(console.log("[Auth] Not running on native mobile - will use web auth"),!1)},k=async e=>{if(!s.firestore)return null;try{let t=(0,n.H9)(s.firestore,"users",e),r=await (0,n.x7)(t);if(r.exists())return r.data();return null}catch(e){return console.error("Error fetching user profile:",e),null}},x=async e=>{if(!s.firestore)throw Error("Firestore not initialized");let t={uid:e.uid,displayName:e.displayName||"Educator",email:e.email,photoURL:e.photoURL,onboardingComplete:!1,credits:20,xp:0,lastRewardedRank:1,isPro:!1,dailyAdCount:0,dailyAiUsage:0,dailyQuestionsAnswered:0,dailyTestsFinished:0,dailyCreditEarned:0,streakCount:0,lastActiveDate:Date.now(),lastTaskReset:Date.now(),referralCode:Math.random().toString(36).substring(2,8).toUpperCase(),taskLoginClaimed:!1,taskQuestionsClaimed:!1,taskMockClaimed:!1,taskMistakesClaimed:!1,mistakesReviewed:0,referralCount:0,referralCreditsEarned:0,referralTier:"Bronze",dailyEventEntries:1,unlockedTracks:[]},r=(0,n.H9)(s.firestore,"users",e.uid);return await (0,n.BN)(r,t),t},A=async()=>{g(!0);try{var e,t;if(C())try{let e=await c.signInWithGoogle();if(e.error){console.error("Native auth error:",e.error),r({variant:"destructive",title:"Native Sign-In Failed",description:e.error.message||"Could not complete native sign-in. Please try again."}),g(!1);return}if(e.user){let t=await k(e.user.uid);t||(t=await x({uid:e.user.uid,displayName:e.user.displayName,email:e.user.email,photoURL:e.user.photoURL})),v(t),g(!1);return}}catch(e){console.error("Native auth failed:",e),r({variant:"destructive",title:"Native Sign-In Failed",description:e.message||"Could not complete native sign-in. Please try again."}),g(!1);return}if(!s.auth)return void r({variant:"destructive",title:"Sign In Failed",description:"Authentication not initialized"});let i=new o.HF;i.setCustomParameters({prompt:"select_account"}),(null==(t=window.Capacitor)||null==(e=t.isNativePlatform)?void 0:e.call(t))||void 0!==window.webkit?await (0,o.$2)(s.auth,i):await (0,o.signInWithPopup)(s.auth,i)}catch(e){"auth/popup-closed-by-user"!==e.code&&"auth/redirect-cancelled-by-user"!==e.code&&r({variant:"destructive",title:"Sign In Failed",description:e.message||"Could not complete sign-in."})}finally{g(!1)}},E=async()=>{if(!s.auth)return;g(!0);let e=new o.sk;try{var t,i;(null==(i=window.Capacitor)||null==(t=i.isNativePlatform)?void 0:t.call(i))||void 0!==window.android||void 0!==window.webkit?await (0,o.$2)(s.auth,e):await (0,o.signInWithPopup)(s.auth,e)}catch(e){"auth/popup-closed-by-user"!==e.code&&"auth/redirect-cancelled-by-user"!==e.code&&r({variant:"destructive",title:"Sign In Failed",description:e.message||"Could not complete Facebook sign-in."})}finally{g(!1)}},N=async()=>{if(s.auth){g(!0);try{await (0,o.zK)(s.auth)}catch(e){r({variant:"destructive",title:"Guest Access Error",description:"Please ensure Anonymous Sign-in is enabled in your Firebase Console."})}finally{g(!1)}}},S=async()=>{if(C())try{await c.signOut()}catch(e){console.error("Native logout error:",e)}s.auth&&await (0,o.CI)(s.auth),v(null),d.push("/")},T=async e=>{if(!s.firestore||!(null==m?void 0:m.uid))return;let t=function e(t){if(void 0===t)return null;if(null===t||"object"!=typeof t||p(t))return t;if(Array.isArray(t))return t.map(e);let r={};for(let i in t){let a=e(t[i]);void 0!==a&&(r[i]=a)}return r}(e),r=(0,n.H9)(s.firestore,"users",m.uid);try{await (0,n.mZ)(r,t)}catch(e){await (0,n.BN)(r,t,{merge:!0})}};return(0,i.jsx)(f.Provider,{value:{user:m,loading:y,loginWithGoogle:A,loginWithFacebook:E,loginAnonymously:N,bypassLogin:()=>{v({uid:"bypass-user",displayName:"Bypass User",email:"bypass@example.com",photoURL:null,majorship:"Mathematics",onboardingComplete:!0,credits:100,xp:1500,lastRewardedRank:1,streakCount:3,dailyAiUsage:25,dailyQuestionsAnswered:40,dailyTestsFinished:2,lastTaskReset:Date.now(),unlockedTracks:[]}),g(!1)},logout:S,updateProfile:T,addXp:b},children:t})}let v=()=>(0,a.useContext)(f)},64269:(e,t,r)=>{r.d(t,{cn:()=>o});var i=r(2821),a=r(75889);function o(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,a.QP)((0,i.$)(t))}},67558:(e,t,r)=>{let i,a,o;r.r(t),r.d(t,{AuthProvider:()=>w.O,FirebaseClientProvider:()=>x,FirebaseProvider:()=>m,auth:()=>a,firebaseApp:()=>i,firestore:()=>o,initializeFirebase:()=>R,isCapacitorNative:()=>S,isWebView:()=>T,signInWithGoogle:()=>F,useAuth:()=>h,useCollection:()=>E,useDoc:()=>N,useFirebase:()=>v,useFirebaseApp:()=>y,useFirestore:()=>g,useUser:()=>w.J});var n=r(52078),s=r(59253),l=r(19708),u=r(32587),d=r(68023),c=r(95155),f=r(12115);let p=(0,f.createContext)({firebaseApp:null,firestore:null,auth:null});function m(e){let{children:t,firebaseApp:r,firestore:i,auth:a}=e;return(0,c.jsx)(p.Provider,{value:{firebaseApp:r,firestore:i,auth:a},children:t})}let v=()=>(0,f.useContext)(p),y=()=>(0,f.useContext)(p).firebaseApp,g=()=>(0,f.useContext)(p).firestore,h=()=>(0,f.useContext)(p).auth;var w=r(37370),b=r(9891),C=r(15894);function k(){let{toast:e}=(0,C.dj)();return(0,f.useEffect)(()=>{let t=t=>{e({variant:"destructive",title:"Firestore Permission Denied",description:"Operation: ".concat(t.context.operation," at ").concat(t.context.path,". Check your Security Rules.")})};return b.d.on("permission-error",t),()=>{b.d.off("permission-error",t)}},[e]),null}function x(e){let{children:t}=e;return(0,c.jsx)(m,{firebaseApp:i,firestore:o,auth:a,children:(0,c.jsxs)(w.O,{children:[(0,c.jsx)(k,{}),t]})})}var A=r(86501);function E(e){let[t,r]=(0,f.useState)(null),[i,a]=(0,f.useState)(!0),[o,n]=(0,f.useState)(null);return(0,f.useEffect)(()=>{if(!e)return void a(!1);let t=(0,l.aQ)(e,e=>{r(e.docs.map(e=>({...e.data(),id:e.id}))),a(!1)},async t=>{var r,i;let o=new A.$({path:(null==(i=e._query)||null==(r=i.path)?void 0:r.toString())||"unknown",operation:"list"});b.d.emit("permission-error",o),n(t),a(!1)});return()=>t()},[e]),{data:t,loading:i,error:o}}function N(e){let[t,r]=(0,f.useState)(null),[i,a]=(0,f.useState)(!0),[o,n]=(0,f.useState)(null);return(0,f.useEffect)(()=>{if(!e)return void a(!1);let t=(0,l.aQ)(e,e=>{r(e.exists()?{...e.data(),id:e.id}:null),a(!1)},async t=>{let r=new A.$({path:e.path,operation:"get"});b.d.emit("permission-error",r),n(t),a(!1)});return()=>t()},[e]),{data:t,loading:i,error:o}}let S=u.Ii.isNativePlatform(),T=void 0!==window.Capacitor||void 0!==window.android||void 0!==window.webkit;function R(){return{firebaseApp:i,auth:a,firestore:o}}async function F(){try{if(u.Ii.isNativePlatform()){var e;let t=await d.uo.signInWithGoogle();if(null==(e=t.credential)?void 0:e.idToken){let e=s.HF.credential(t.credential.idToken);return{user:(await (0,s.eN)(a,e)).user,error:null}}return{user:null,error:Error("No credential returned from native sign-in")}}{let e=new s.HF;e.setCustomParameters({prompt:"select_account"});let{signInWithPopup:t}=await Promise.resolve().then(r.bind(r,59253));return{user:(await t(a,e)).user,error:null}}}catch(e){return console.error("Google Sign-In Error:",e),{user:null,error:e}}}i=0===(0,n.Dk)().length?(0,n.Wp)({apiKey:"AIzaSyDQmt8o2YeCrB3yIoxjVDosJA7EJUttWTU",authDomain:"letpractice.firebaseapp.com",projectId:"letpractice",storageBucket:"letpractice.firebasestorage.app",messagingSenderId:"322612236786",appId:"1:322612236786:web:922392c848421068621b6b"}):(0,n.Sx)(),a=(0,s.xI)(i),o=(0,l.aU)(i),(!S||T)&&(0,s.oM)(a,s.F0).catch(console.error)},86501:(e,t,r)=>{r.d(t,{$:()=>i});class i extends Error{constructor(e){super("Firestore Security Rules denied the request for ".concat(e.operation," at ").concat(e.path)),this.name="FirestorePermissionError",this.context=e}}},86948:(e,t,r)=>{r.d(t,{BT:()=>u,Wu:()=>d,ZB:()=>l,Zp:()=>n,aR:()=>s,wL:()=>c});var i=r(95155),a=r(12115),o=r(64269);let n=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,i.jsx)("div",{ref:t,className:(0,o.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",r),...a})});n.displayName="Card";let s=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,i.jsx)("div",{ref:t,className:(0,o.cn)("flex flex-col space-y-1.5 p-6",r),...a})});s.displayName="CardHeader";let l=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,i.jsx)("div",{ref:t,className:(0,o.cn)("text-2xl font-semibold leading-none tracking-tight",r),...a})});l.displayName="CardTitle";let u=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,i.jsx)("div",{ref:t,className:(0,o.cn)("text-sm text-muted-foreground",r),...a})});u.displayName="CardDescription";let d=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,i.jsx)("div",{ref:t,className:(0,o.cn)("p-6 pt-0",r),...a})});d.displayName="CardContent";let c=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,i.jsx)("div",{ref:t,className:(0,o.cn)("flex items-center p-6 pt-0",r),...a})});c.displayName="CardFooter"}}]);